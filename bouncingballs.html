<!DOCTYPE html>
<html>
<head>

</head>

<body>
<p>TEST page</p>
<!-- 	dx: <div id="dx"></div>
	dy: <div id="dy"></div>
	test: <div id="test"></div> -->
</body>

<script type="text/javascript">

// Configuration variables
var canvasWidth = 150;
var canvasHeight = 100;
var speed = 1;
var amountBalls = 4;
var collisionProximity = 4;


// create canvas
var canvas = document.createElement("canvas");
canvas.setAttribute("width", canvasWidth);
canvas.setAttribute("height", canvasHeight);
canvas.setAttribute("style", "border:1px solid");
canvas.id = "bouncingBalls"
document.body.appendChild(canvas);

// Get canvas element context
var c = document.getElementById("bouncingBalls");
var ctx = c.getContext("2d");

// Ball class
function Ball(positionx, positiony, speed, directionx, directiony) {
	this.speed = speed;
	this.positionx = positionx;
	this.positiony = positiony;
	this.directionx = directionx;
	this.directiony = directiony;
}

// Move ball method
Ball.prototype.moveBall = function() {
	// document.getElementById("dx").innerHTML = this.positionx;
	// document.getElementById("dy").innerHTML = this.positiony;
	
	ctx.fillStyle = "#000000";
	ctx.beginPath();
	ctx.arc(this.positionx, this.positiony, 5, 0, 2 * Math.PI);
	ctx.stroke();
	ctx.closePath();
	ctx.fill();

	this.positionx += (this.directionx * this.speed);
	this.positiony += (this.directiony * this.speed);

	// check for ball collisions
	for(var i=0;i<ballArray.length;i++) {
		that = ballArray[i];
		if(this == that) {
			continue;
		}

		difference = diff(this, that)
		if(collision(difference)) {
			// change ball direction
			this.directionx *= -1;
			this.directiony *= -1;

		}

	}

	// bounce if ball hits wall
	if(this.positionx > canvasWidth || this.positionx < 0) {
		this.directionx *= -1;
	}
	if(this.positiony > canvasHeight || this.positiony < 0) {
		this.directiony *= -1;
	}



}

// diff of x and y in absolute terms
function diff(currentBall, otherBall) {
	diffx = Math.round(currentBall.positionx - otherBall.positionx);
	diffy = Math.round(currentBall.positiony - otherBall.positiony);
	return [diffx, diffy];
}

// check if collision
function collision(diff) {
	if(diff[0] < collisionProximity && diff[0] > -collisionProximity && diff[1] < collisionProximity && diff[1] > -collisionProximity) {
		return true;
	}
	return false;
}

Ball.prototype.getPositions = function() {
	return [Math.round(this.positionx), Math.round(this.positiony)];
}

Ball.prototype.changeDirection = function(axis) {
	if(axis == 'x') {
		this.directionx *= -1;
	}
	else if(axis == 'y') {
		this.directionx *= -1;
	}
	else if(axis == 'xy') {
		// this.positionx += this.directionx;
		// this.positiony += this.directiony;
		this.directionx *= -1;
		this.directiony *= -1;

	}
	else {
		alert("Error at change direction. It is not x or y of xy...")
	}
}

// Create ball
function createBall() {
	positionx = Math.round(Math.random()*canvasWidth);
	positiony = Math.round(Math.random()*canvasHeight);
	directionx = Math.random();
	directiony = Math.sqrt(1 - Math.pow(directionx, 2));
	return new Ball(positionx, positiony, speed, directionx, directiony)
}

// Initiate app
function init() {
	// generate array with ball objects
	ballArray = [];
	for(var i=0;i<amountBalls;i++) {
		ballArray.push(createBall());
	}
}

// Run app
function runApp() {
	ctx.clearRect(0, 0, canvasWidth, canvasHeight);
	// For every ball call move method
	for(var i=0;i<amountBalls;i++) {
		ballArray[i].moveBall();
	}
}

Ball.prototype.getDirectionx = function() {
	return "postionx: " + this.positionx + " postiony: " + this.positiony + " directionx: " + this.directionx;
}

// Bootstrap this shit
init();
setInterval(runApp,2);

</script>

</html>